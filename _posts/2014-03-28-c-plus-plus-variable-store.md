---
layout: post
title: "C++中的变量存储"
description: ""
category: CPP
tags: [static, const]
---
{% include JB/setup %}

与变量存储相关的描述：作用域、存储持续性和链接性。与存储相关的说明符有：`auto`、`register`、`static`、`extern`、`mutable`以及cv限定符： `const` 和 `volatile`

**作用域**描述了名称在文件(翻译单元)中的可见范围。定义在函数内部的变量只能在该函数中使用；在文件中的函数定义之前定义的变量则可在所有函数中使用。作用域强调的是在文件中。

**链接性**描述了名称在不同单元之间的共享。链接性为外部的名称可在文件间共享；链接性为内部的名称只能由一个文件中的函数共享。

**存储持续性**描述了数据在内存中存在的时间，其中包括三种：自动存储持续性、静态存储持续性、动态存储持续性。


**`auto`声明自动变量。**在函数内声明的形参和变量，当执行完函数或代码块时，它们使用的内存被自动释放，被称为自动变量。auto只能用于默认状态为自动的变量，因此几乎不使用它。auto声明的变量被存储于内存堆栈中。

**`register`声明寄存器变量。**寄存器变量也是一种自动变量，register关键字提醒编译器，希望使用CPU寄存器来存储变量，但是编译器不一定满足这个请求。存储在寄存器上的变量没有内存地址，因此不能将地址操作符用于寄存器变量，即使声明的寄存器变量最终被存储在内存上。

**`static`声明静态变量。**静态变量在程序的运行期间都存在，在函数外部定义的变量和使用static 的变量都是静态变量。未被初始化的静态变量所有位都被置零。
在函数外部定义的变量是外部变量，因为链接性为外部。当static用在函数外部定义的变量时，会改变变量的链接性，使链接性变为内部。
在函数内部定义使用static关键字的变量被称为静态局部变量，在该代码块不处于活动状态时仍然存在，程序只在启动时对它进行一次初始化。
函数默认的链接性为外部，因此只有一个文件包含该函数定义，但使用该函数的每个文件都应包含其函数原型。关键字static将函数的链接性改为内部。

**`extern`声明引用其他位置的变量。**外部变量有且只有一个文件包含了该变量的外部定义，其他文件要使用该变量，必须在声明中使用关键字extern。

**`mutable`限定类数据成员的可变性。**当类的成员函数被const限定，意味着不能对类的数据修改。但是当类的数据成员被mutable限定，则允许了const限定的成员函数对其修改。

**`const`声明符号常量。**在函数外部定义的变量，被const限定时，则链接性变为内部，与static类似。

**`volatile` 声明变量的易变性。**变量在内存单元存储的数据未被程序修改，它的值也可能会发生变化时，要用volatile限定。这种情况发生在程序间进行交互或数据共享时，要对内存进行数据读写控制。volatile 告诉编译器，每次使用变量时都要去内存取数据。因为默认情况下，编译器存在着优化：如果将变量缓存到寄存器中，就不会到内存取值，导致取值不是最新数据。

